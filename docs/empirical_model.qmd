---
title: "Empirical Hierarchical Model: Theory and Implementation"
date: last-modified
---

## Overview

The "Empirical" model (`model_empirical`) represents a departure from the physics-based models that rely on Finite Element Model (FEM) simulations. Instead of calibrating physical parameters ($E_1, E_2$, etc.) against simulation data, this model treats the experimental data as a direct hierarchical regression problem.

This approach is particularly useful when:

*   Likelihood of FEM mismatch is high.
*   We want to establish a baseline for pure data-driven performance.
*   Physical parameter identification is not the primary goal, but rather predictive performance for new experiments.

## Mathematical Formulation

### Core Regression

The model posits that the extension ($y$) is linearly related to Load ($P$) through an effective slope ($\beta$), which accounts for both the global material response, geometric projection, and experimental variability:

$$ y_v = P \cdot \beta_v + \epsilon $$
$$ y_h = P \cdot \beta_h + \epsilon $$

### Hierarchical Structure

The effective slopes $\beta$ are constructed from direction-specific global emulator slopes, probabilistic geometric factors ($\gamma$), and an experiment-specific bias ($b_i$):

$$ \beta_{v,i} = \mu_{emulator,v} \cdot \gamma_{v,\alpha_i} + b_i $$
$$ \beta_{h,i} = \mu_{emulator,h} \cdot \gamma_{h,\alpha_i} + b_i $$

Where:

*   **Direction-Specific Global Slopes**: The foundational stiffness/compliance parameters for each loading direction.
    *   **Normal Direction** ($\mu_{emulator,v}$): 
        $$ \mu_{emulator,v} \sim \text{LogNormal}(\ln(0.01), 0.2) $$
    *   **Shear Direction** ($\mu_{emulator,h}$): 
        $$ \mu_{emulator,h} \sim \text{LogNormal}(\ln(0.01), 0.2) $$
    *   **Prior**: Independent LogNormal distributions with `log_mean` = $\ln(0.01) \approx -4.605$ and `log_scale` = 0.2.
    *   **Interpretation**: Median slope of $0.01$ for both directions, allowing independent learning of systematic corrections for Normal and Shear responses.

*   **Geometric Factors** ($\gamma$): Probabilistic terms that typically track the trigonometric projection ($\cos \alpha, \sin \alpha$) but allow for deviation (e.g., misalignment).
    *   **Shared per Angle**: All experiments conducted at the same angle $\alpha$ share the same $\gamma$ parameters.
    $$ \gamma_{v,\alpha} \sim \mathcal{N}(\cos(\alpha), \sigma_{\gamma,v}^2) $$
    $$ \gamma_{h,\alpha} \sim \mathcal{N}(\sin(\alpha), \sigma_{\gamma,h}^2) $$
    *   $\sigma_{\gamma,v}$ (`gamma_scale_v`) and $\sigma_{\gamma,h}$ (`gamma_scale_h`) are **inferred hyperparameters** that control the variance of the geometric factors.
        *   **Prior**: $\sigma_{\gamma} \sim \text{Exponential}(10)$, implying a mean standard deviation of $0.1$. This allows the model to learn the optimal flexibility from the data, starting from a baseline assumption of $\sim 10\%$ geometric variability.

*   **Experiment Bias** ($b_i$): An additive offset to the slope for experiment $i$.
    $$ b_i \sim \mathcal{N}(0, \sigma_{b\_slope}^2) $$
    *   $\sigma_{b\_slope} \sim \text{Exponential}(1000)$, implying a mean standard deviation of $0.001$ ($0.1\%$). This acts as a strong regularization, assuming that experiment-specific deviations from the shared slope are extremely small.

*   **Test Angle** ($\alpha_i$): The angle (radians or degrees) at which experiment $i$ was conducted.
    *   Standard configuration: $45^\circ, 90^\circ, 135^\circ$ (Consistent with previous Certest models).

### Likelihood

The likelihood assumes independent Gaussian noise around the mean prediction:
$$ y_{obs} \sim \mathcal{N}(P \cdot \beta, \Sigma_{noise}) $$

## Implementation Details

### Code Structure

The model is implemented in `src/core/models.py` (`model_empirical`).

*   **Gamma Sampling**: The model identifies unique angles (e.g., 45, 90, 135) and samples a shared $\gamma_v$ and $\gamma_h$ for each unique angle derived from the data. These shared parameters are then mapped to each experiment.
*   **Prediction**: The `posterior_predict` function replicates this generative process, sampling latent $\gamma$ values to generate uncertainty bands that reflect potential geometric misalignment.

### Configuration

Update `configs/default_config.py` to control the model:

```python
config = {
    "model_type": "model_empirical",
    # Prior configuration
    "priors": {
        "hyper": {
             "gamma_scale_v": {"target_dist": dist.Exponential(10)},
             "gamma_scale_h": {"target_dist": dist.Exponential(10)},
        },
    },
    "bias": {
        "add_bias_slope": True,
    },
}
```
