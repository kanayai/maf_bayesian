---
title: "Empirical Hierarchical Model: Theory and Implementation"
date: last-modified
---

## Overview

The "Empirical" model (`model_empirical`) represents a departure from the physics-based models that rely on Finite Element Model (FEM) simulations. Instead of calibrating physical parameters ($E_1, E_2$, etc.) against simulation data, this model treats the experimental data as a direct hierarchical regression problem.

This approach is particularly useful when:

*   Likelihood of FEM mismatch is high.
*   We want to establish a baseline for pure data-driven performance.
*   Physical parameter identification is not the primary goal, but rather predictive performance for new experiments.

## Mathematical Formulation

### Core Regression

The model posits that the extension ($y$) is linearly related to Load ($P$) through an effective slope ($\beta$), which accounts for both the global material response, geometric projection, and experimental variability:

$$ y_v = P \cdot \beta_v + \epsilon $$
$$ y_h = P \cdot \beta_h + \epsilon $$

### Hierarchical Structure

The effective slopes $\beta$ are constructed from a global emulator slope, probabilistic geometric factors ($\gamma$), and an experiment-specific bias ($b_i$):

$$ \beta_{v,i} = \mu_{emulator} \cdot \gamma_{v,\alpha_i} + b_i $$
$$ \beta_{h,i} = \mu_{emulator} \cdot \gamma_{h,\alpha_i} + b_i $$

Where:

*   **Global Slope** ($\mu_{emulator}$): The foundational stiffness/compliance parameter share across all experiments.
    $$ \mu_{emulator} \sim \text{LogNormal}(\dots) $$

*   **Geometric Factors** ($\gamma$): Probabilistic terms that typically track the trigonometric projection ($\cos \alpha, \sin \alpha$) but allow for deviation (e.g., misalignment).
    *   **Shared per Angle**: All experiments conducted at the same angle $\alpha$ share the same $\gamma$ parameters.
    $$ \gamma_{v,\alpha} \sim \mathcal{N}(\cos(\alpha), \sigma_\gamma^2) $$
    $$ \gamma_{h,\alpha} \sim \mathcal{N}(\sin(\alpha), \sigma_\gamma^2) $$
    *   $\sigma_\gamma$ (`gamma_scale`) is a configurable hyperparameter.

*   **Experiment Bias** ($b_i$): An additive offset to the slope for experiment $i$.
    $$ b_i \sim \mathcal{N}(0, \sigma_{b\_slope}^2) $$

*   **Test Angle** ($\alpha_i$): The angle (radians or degrees) at which experiment $i$ was conducted.
    *   Standard configuration: $45^\circ, 90^\circ, 135^\circ$ (Consistent with previous Certest models).

### Likelihood

The likelihood assumes independent Gaussian noise around the mean prediction:
$$ y_{obs} \sim \mathcal{N}(P \cdot \beta, \Sigma_{noise}) $$

## Implementation Details

### Code Structure

The model is implemented in `src/core/models.py` (`model_empirical`).

*   **Gamma Sampling**: The model identifies unique angles (e.g., 45, 90, 135) and samples a shared $\gamma_v$ and $\gamma_h$ for each unique angle derived from the data. These shared parameters are then mapped to each experiment.
*   **Prediction**: The `posterior_predict` function replicates this generative process, sampling latent $\gamma$ values to generate uncertainty bands that reflect potential geometric misalignment.

### Configuration

Update `configs/default_config.py` to control the model:

```python
config = {
    "model_type": "model_empirical",
    "empirical": {
        "gamma_scale": 0.1,  # Standard deviation for gamma factors
    },
    "bias": {
        "add_bias_slope": True,
    },
}
```
